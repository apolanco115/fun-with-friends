{"ast":null,"code":"import _regeneratorRuntime from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import P5Wrapper from'react-p5-wrapper';import Sketch from\"react-p5\";import p5 from'p5';import SockJS from'sockjs-client';import Stomp from'stompjs';import CircularProgress from'@material-ui/core/CircularProgress';import CreateRoom from\"../components/CreateRoom\";var PongWithFriends=/*#__PURE__*/function(_Component){_inherits(PongWithFriends,_Component);function PongWithFriends(){var _getPrototypeOf2;var _this;_classCallCheck(this,PongWithFriends);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(PongWithFriends)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={sender:'',room:'',isPlayer2:true,showForm:true,isConnected:false};_this.ws=null;_this.stompClient=null;_this.topic=null;_this.currentSubscription=null;_this.p=new p5();_this.setupBeforeUnloadListener=function(){window.addEventListener(\"beforeunload\",function(ev){ev.preventDefault();var confirmationMessage='you are now leaving';_this.disconnect(ev);ev.returnValue=confirmationMessage;return confirmationMessage;});};_this.setUserAndRoom=function(usr){// this.login(usr);\nconsole.log(\"the set data:\"+usr.user);_this.setState({sender:usr.user,room:usr.room,showForm:false},function(){var username=_this.state.sender;_this.joinRoom();});};_this.getRoomDetails=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var roomDetailsResponse,roomDetailsJson;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"/game-room/\".concat(_this.state.room,\"-details\"),{method:'get',headers:{Authorization:\"Bearer \"+localStorage.getItem(\"user\"),\"Content-Type\":\"application/json\"}});case 3:roomDetailsResponse=_context.sent;_context.next=6;return roomDetailsResponse.json();case 6:roomDetailsJson=_context.sent;console.log(roomDetailsJson);_this.numUsers=roomDetailsJson.userCount;if(_this.numUsers<1){_this.setState({isPlayer2:false});}console.log(_this.numUsers);if(_this.numUsers==2){_this.setState({hasBothPlayers:true});_this.ws=new SockJS(\"/play\");_this.stompClient=Stomp.over(_this.ws);_this.stompClient.connect({},_this.onConnected);}_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);console.log('error obtaining room details');console.log(_context.t0);case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));_this.joinRoom=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var joinRoomResponse;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"/game-room/join-\".concat(_this.state.room),{method:\"post\",headers:{Authorization:\"Bearer \"+localStorage.getItem(\"user\"),\"Content-Type\":\"application/json\"}});case 3:joinRoomResponse=_context2.sent;_this.getRoomDetails();_context2.next=11;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log('Error joining room!');console.log(_context2.t0);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));_this.onConnected=function(){_this.enterRoom();};_this.onMessageReceived=function(message){var messageDat=JSON.parse(message.body);console.log(\"the sender: \"+messageDat.sender);if(messageDat.sender!==_this.state.sender&&messageDat.type==='CHAT'){_this.updateMovements(messageDat);}console.log(\"received: \"+messageDat);};_this.enterRoom=function(){var username=_this.state.name;_this.topic=\"/app/game/\".concat(_this.state.room);if(_this.currentSubscription){_this.currentSubscription.unsubscribe();}_this.currentSubscription=_this.stompClient.subscribe(\"/topic/\".concat(_this.state.room),_this.onMessageReceived);_this.stompClient.send(\"\".concat(_this.topic,\"/addUser\"),{},JSON.stringify({sender:username,type:'JOIN'}));_this.setState({isConnected:true});};_this.leaveRoom=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var leaveRoomResponse;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return fetch(\"/game-room/leave\",{method:\"post\",headers:{Authorization:\"Bearer \"+localStorage.getItem(\"user\"),\"Content-Type\":\"application/json\"}});case 3:leaveRoomResponse=_context3.sent;_context3.next=10;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);console.log('Error leaving room!');console.log(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[0,6]]);}));_this.disconnect=function(event){if(_this.stompClient!==null){_this.leaveRoom();console.log(\"left room\");// Tell your username to the server\n_this.currentSubscription=_this.stompClient.subscribe(\"/topic/\".concat(_this.state.room),_this.onMessageReceived);_this.stompClient.send(\"\".concat(_this.topic,\"/addUser\"),{},JSON.stringify({sender:_this.state.name,type:'LEAVE'}));_this.setState({isConnected:false});_this.stompClient.disconnect({});}event.preventDefault();};_this.canvasWidth=800;_this.canvasHeight=800;_this.ball={ballX:Math.floor(Math.random()*300)+50,ballY:50,diameter:50,ballVx:5,ballVy:7,canvasWidth:null,canvasHeight:null,p:null,moveAndDraw:function moveAndDraw(){this.p.fill(255,0,255);this.p.ellipse(this.ballX,this.ballY,this.diameter,this.diameter);this.p.fill('#FFFFFF');this.ballX+=this.ballVx;this.ballY+=this.ballVy;if(this.ballX<this.diameter*0.5||this.ballX>this.canvasWidth-this.diameter*0.5){this.ballVx*=-1;}if(this.ballY<this.diameter*0.5||this.ballY>this.canvasHeight-this.diameter*0.5){this.ballVy*=-1;}}};_this.paddle={paddleWidth:20,paddleHeight:150,paddleX:20,paddleY:0,canvasWidth:null,isPlayer2:false,p:null,drawPaddle:function drawPaddle(){if(!this.isPlayer2){this.p.fill(255);this.p.rect(this.paddleX,this.paddleY,this.paddleWidth,this.paddleHeight);}else{this.p.fill(255);this.p.rect(this.canvasWidth-2*this.paddleWidth,this.paddleY,this.paddleWidth,this.paddleHeight);}}};_this.ball=Object.create(_this.ball,{canvasWidth:{value:_this.canvasWidth},canvasHeight:{value:_this.canvasHeight},p:{value:_this.p}});_this.paddle1=Object.create(_this.paddle,{canvasWidth:{value:_this.canvasWidth},isPlayer2:{value:false},p:{value:_this.p}});_this.paddle2=Object.create(_this.paddle,{canvasWidth:{value:_this.canvasWidth},isPlayer2:{value:true},p:{value:_this.p}});_this.setup=function(p5,parent){_this.p.createCanvas(_this.canvasWidth,_this.canvasHeight).parent(parent);_this.p.frameRate(60);};_this.updateMovements=function(messageContent){var data=JSON.parse(messageContent.content);_this.paddle1.paddleY=data.paddle1Y;_this.paddle2.paddleY=data.paddle2Y;_this.ball.ballX=data.ballX;_this.ball.ballY=data.ballY;_this.ball.ballVx=data.ballVy;};_this.sendMovements=function(){if(_this.goUp===1){if(!_this.state.isPlayer2){_this.paddle1.paddleY-=10;}else{_this.paddle2.paddleY-=10;}}if(_this.goDown===1){if(!_this.state.isPlayer2){_this.paddle1.paddleY+=10;}else{_this.paddle2.paddleY+=10;}}if(_this.paddle1.paddleY+_this.paddle1.paddleHeight>_this.canvasHeight){_this.paddle1.paddleY=_this.canvasHeight-_this.paddle1.paddleHeight;}if(_this.paddle1.paddleY<0){_this.paddle1.paddleY=0;}if(_this.ball.ballY>_this.paddle1.paddleY&&_this.ball.ballY<_this.paddle1.paddleY+_this.paddle1.paddleHeight&&_this.ball.ballX-_this.ball.diameter/2<=40){_this.ball.ballVx*=-1;}var data={sender:_this.state.sender,content:JSON.stringify({paddle1Y:_this.paddle1.paddleY,paddle2Y:_this.paddle2.paddleY,ballX:_this.ball.ballX,ballY:_this.ball.ballY,ballVx:_this.ball.ballVx}),type:'CHAT'};//send data code below\n_this.stompClient.send(\"\".concat(_this.topic,\"/sendMessage\"),{},JSON.stringify(data));if(_this.state.hasBothPlayers){_this.ball.moveAndDraw();_this.paddle1.drawPaddle();_this.paddle2.drawPaddle();}};_this.draw=function(p5){_this.p.background(51);_this.sendMovements();};_this.keyPressed=function(p5){if(_this.p.keyCode===_this.p.UP_ARROW){_this.goUp=1;}if(_this.p.keyCode===_this.p.DOWN_ARROW){_this.goDown=1;}};_this.keyReleased=function(p5){if(_this.p.keyCode===_this.p.UP_ARROW){_this.goUp=0;}if(_this.p.keyCode===_this.p.DOWN_ARROW){_this.goDown=0;}};return _this;}_createClass(PongWithFriends,[{key:\"componentDidMount\",value:function componentDidMount(){this.setupBeforeUnloadListener();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.setupBeforeUnloadListener();}},{key:\"render\",value:function render(){var form=React.createElement(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'}},React.createElement(CreateRoom,{setUserAndRoom:this.setUserAndRoom}));var loading=React.createElement(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'}},React.createElement(CircularProgress,null));var canvas=React.createElement(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'}},React.createElement(Sketch,{setup:this.setup,draw:this.draw,keyPressed:this.keyPressed,keyReleased:this.keyReleased}));// return canvas;\nreturn this.state.showForm?form:this.state.isConnected?canvas:loading;}}]);return PongWithFriends;}(Component);export default PongWithFriends;","map":{"version":3,"sources":["/app/src/main/fun-with-friends/src/sketches/PongWithFriends.js"],"names":["React","Component","P5Wrapper","Sketch","p5","SockJS","Stomp","CircularProgress","CreateRoom","PongWithFriends","state","sender","room","isPlayer2","showForm","isConnected","ws","stompClient","topic","currentSubscription","p","setupBeforeUnloadListener","window","addEventListener","ev","preventDefault","confirmationMessage","disconnect","returnValue","setUserAndRoom","usr","console","log","user","setState","username","joinRoom","getRoomDetails","fetch","method","headers","Authorization","localStorage","getItem","roomDetailsResponse","json","roomDetailsJson","numUsers","userCount","hasBothPlayers","over","connect","onConnected","joinRoomResponse","enterRoom","onMessageReceived","message","messageDat","JSON","parse","body","type","updateMovements","name","unsubscribe","subscribe","send","stringify","leaveRoom","leaveRoomResponse","event","canvasWidth","canvasHeight","ball","ballX","Math","floor","random","ballY","diameter","ballVx","ballVy","moveAndDraw","fill","ellipse","paddle","paddleWidth","paddleHeight","paddleX","paddleY","drawPaddle","rect","Object","create","value","paddle1","paddle2","setup","parent","createCanvas","frameRate","messageContent","data","content","paddle1Y","paddle2Y","sendMovements","goUp","goDown","draw","background","keyPressed","keyCode","UP_ARROW","DOWN_ARROW","keyReleased","form","display","justifyContent","alignItems","height","loading","canvas"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport P5Wrapper from 'react-p5-wrapper';\nimport Sketch from \"react-p5\";\nimport p5 from 'p5';\nimport SockJS from 'sockjs-client';\nimport Stomp from 'stompjs';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport CreateRoom from \"../components/CreateRoom\";\n\nclass PongWithFriends extends Component {\n    state = {\n        sender: '',\n        room: '',\n        isPlayer2: true,\n        showForm: true,\n        isConnected: false,\n    };\n    numUsers;\n    ws = null;\n    stompClient = null;\n    topic = null;\n    currentSubscription = null;\n    p = new p5();\n\n\n    setupBeforeUnloadListener = () => {\n        window.addEventListener(\"beforeunload\", (ev) => {\n            ev.preventDefault();\n            const confirmationMessage = 'you are now leaving'\n            this.disconnect(ev);\n            ev.returnValue = confirmationMessage\n            return confirmationMessage;\n        });\n    };\n\n    componentDidMount() {\n        this.setupBeforeUnloadListener();\n    }\n\n    componentWillUnmount() {\n        this.setupBeforeUnloadListener();\n    }\n\n    setUserAndRoom = (usr) => {\n        // this.login(usr);\n        console.log(\"the set data:\" + usr.user);\n        this.setState({\n            sender: usr.user,\n            room: usr.room,\n            showForm: false\n        }, () => {\n            const username = this.state.sender;\n            this.joinRoom();\n        })\n    }\n\n    getRoomDetails = async () => {\n        try {\n            const roomDetailsResponse = await fetch(`/game-room/${this.state.room}-details`,\n                {\n                    method: 'get',\n                    headers: {\n                        Authorization: \"Bearer \" + localStorage.getItem(\"user\"),\n                        \"Content-Type\": \"application/json\"\n                    }\n                });\n            const roomDetailsJson = await roomDetailsResponse.json()\n            console.log(roomDetailsJson)\n            this.numUsers = roomDetailsJson.userCount;\n            if (this.numUsers < 1) {\n                this.setState({isPlayer2: false})\n            }\n            console.log(this.numUsers)\n            if(this.numUsers==2){\n                this.setState({hasBothPlayers: true})\n                this.ws = new SockJS(\"/play\");\n                this.stompClient = Stomp.over(this.ws);\n                this.stompClient.connect({}, this.onConnected)\n            }\n        }\n         catch (e) {\n            console.log('error obtaining room details')\n            console.log(e)\n        }\n    }\n\n    joinRoom = async () => {\n        try {\n            const joinRoomResponse = await fetch(`/game-room/join-${this.state.room}`,\n                {\n                    method: \"post\",\n                    headers: {\n                        Authorization: \"Bearer \" + localStorage.getItem(\"user\"),\n                        \"Content-Type\": \"application/json\"\n                    }\n                })\n            this.getRoomDetails();\n\n        } catch (error) {\n            console.log('Error joining room!')\n            console.log(error)\n        }\n    }\n\n    onConnected = () => {\n        this.enterRoom();\n    }\n\n    onMessageReceived = (message) => {\n        const messageDat = JSON.parse(message.body);\n        console.log(\"the sender: \" + messageDat.sender)\n        if ((messageDat.sender !== this.state.sender) && messageDat.type === 'CHAT') {\n            this.updateMovements(messageDat);\n        }\n        console.log(\"received: \" + messageDat)\n    }\n\n\n    enterRoom = () => {\n        const username = this.state.name;\n        this.topic = `/app/game/${this.state.room}`;\n        if (this.currentSubscription) {\n            this.currentSubscription.unsubscribe();\n        }\n        this.currentSubscription = this.stompClient.subscribe(`/topic/${this.state.room}`, this.onMessageReceived);\n\n        this.stompClient.send(`${this.topic}/addUser`, {}, JSON.stringify({sender: username, type: 'JOIN'}));\n        this.setState({isConnected: true})\n\n    }\n\n\n    leaveRoom = async () => {\n        try {\n            const leaveRoomResponse = await fetch(`/game-room/leave`,\n                {\n                    method: \"post\",\n                    headers: {\n                        Authorization: \"Bearer \" + localStorage.getItem(\"user\"),\n                        \"Content-Type\": \"application/json\"\n                    }\n                })\n        } catch (e) {\n            console.log('Error leaving room!');\n            console.log(e);\n        }\n    }\n\n    disconnect = (event) => {\n        if (this.stompClient !== null) {\n            this.leaveRoom();\n            console.log(\"left room\");\n            // Tell your username to the server\n            this.currentSubscription = this.stompClient.subscribe(`/topic/${this.state.room}`, this.onMessageReceived);\n\n            this.stompClient.send(`${this.topic}/addUser`, {}, JSON.stringify({\n                sender: this.state.name,\n                type: 'LEAVE'\n            }));\n            this.setState({isConnected: false})\n            this.stompClient.disconnect({});\n        }\n        event.preventDefault();\n\n    }\n\n\n    canvasWidth = 800;\n    canvasHeight = 800;\n    goUp;\n    goDown;\n\n    ball = {\n        ballX: Math.floor(Math.random() * 300) + 50,\n        ballY: 50,\n        diameter: 50,\n        ballVx: 5,\n        ballVy: 7,\n        canvasWidth: null,\n        canvasHeight: null,\n        p: null,\n        moveAndDraw: function () {\n            this.p.fill(255, 0, 255);\n            this.p.ellipse(this.ballX, this.ballY, this.diameter, this.diameter);\n            this.p.fill('#FFFFFF');\n\n            this.ballX += this.ballVx;\n            this.ballY += this.ballVy;\n            if (this.ballX < this.diameter * 0.5 || this.ballX > this.canvasWidth - this.diameter * 0.5) {\n                this.ballVx *= -1;\n            }\n            if (this.ballY < this.diameter * 0.5 || this.ballY > this.canvasHeight - this.diameter * 0.5) {\n                this.ballVy *= -1;\n            }\n        }\n\n    }\n\n    paddle = {\n        paddleWidth: 20,\n        paddleHeight: 150,\n        paddleX: 20,\n        paddleY: 0,\n        canvasWidth: null,\n        isPlayer2: false,\n        p: null,\n        drawPaddle: function () {\n            if (!this.isPlayer2) {\n                this.p.fill(255);\n                this.p.rect(this.paddleX, this.paddleY, this.paddleWidth, this.paddleHeight);\n            } else {\n                this.p.fill(255);\n                this.p.rect(this.canvasWidth - 2 * this.paddleWidth, this.paddleY, this.paddleWidth, this.paddleHeight);\n            }\n\n        }\n    }\n\n\n    ball = Object.create(this.ball,\n        {\n            canvasWidth:\n                {value: this.canvasWidth},\n            canvasHeight:\n                {value: this.canvasHeight},\n            p:\n                {value: this.p}\n        }\n    );\n\n    paddle1 = Object.create(this.paddle,\n        {\n            canvasWidth:\n                {value: this.canvasWidth},\n            isPlayer2:\n                {value: false},\n            p:\n                {value: this.p}\n        });\n\n    paddle2 = Object.create(this.paddle,\n        {\n            canvasWidth:\n                {value: this.canvasWidth},\n            isPlayer2:\n                {value: true},\n            p:\n                {value: this.p}\n        });\n\n    setup = (p5, parent) => {\n        this.p.createCanvas(this.canvasWidth, this.canvasHeight).parent(parent);\n        this.p.frameRate(60);\n    }\n\n    updateMovements = (messageContent) => {\n        const data = JSON.parse(messageContent.content);\n        this.paddle1.paddleY = data.paddle1Y;\n        this.paddle2.paddleY = data.paddle2Y;\n        this.ball.ballX = data.ballX;\n        this.ball.ballY = data.ballY;\n        this.ball.ballVx = data.ballVy;\n    }\n\n    sendMovements = () => {\n        if (this.goUp === 1) {\n            if (!this.state.isPlayer2) {\n                this.paddle1.paddleY -= 10;\n            } else {\n                this.paddle2.paddleY -= 10;\n            }\n        }\n        if (this.goDown === 1) {\n            if (!this.state.isPlayer2) {\n                this.paddle1.paddleY += 10;\n            } else {\n                this.paddle2.paddleY += 10;\n            }\n        }\n        if ((this.paddle1.paddleY + this.paddle1.paddleHeight) > this.canvasHeight) {\n            this.paddle1.paddleY = this.canvasHeight - this.paddle1.paddleHeight;\n        }\n        if (this.paddle1.paddleY < 0) {\n            this.paddle1.paddleY = 0;\n        }\n        if ((this.ball.ballY > this.paddle1.paddleY && this.ball.ballY < this.paddle1.paddleY + this.paddle1.paddleHeight) && (this.ball.ballX - this.ball.diameter / 2 <= 40)) {\n            this.ball.ballVx *= -1;\n        }\n        const data = {\n            sender: this.state.sender,\n            content: JSON.stringify({\n                paddle1Y: this.paddle1.paddleY,\n                paddle2Y: this.paddle2.paddleY,\n                ballX: this.ball.ballX,\n                ballY: this.ball.ballY,\n                ballVx: this.ball.ballVx\n            }),\n            type: 'CHAT'\n        }\n        //send data code below\n        this.stompClient.send(`${this.topic}/sendMessage`, {}, JSON.stringify(data));\n        if(this.state.hasBothPlayers){\n        this.ball.moveAndDraw();\n        this.paddle1.drawPaddle()\n        this.paddle2.drawPaddle()}\n\n    }\n\n    draw = (p5) => {\n        this.p.background(51);\n        this.sendMovements();\n\n    }\n\n    keyPressed = (p5) => {\n        if (this.p.keyCode === this.p.UP_ARROW) {\n            this.goUp = 1;\n\n        }\n        if (this.p.keyCode === this.p.DOWN_ARROW) {\n            this.goDown = 1;\n\n        }\n    }\n\n    keyReleased = (p5) => {\n        if (this.p.keyCode === this.p.UP_ARROW) {\n            this.goUp = 0;\n        }\n        if (this.p.keyCode === this.p.DOWN_ARROW) {\n            this.goDown = 0;\n        }\n\n    }\n\n    render() {\n        const form = (\n            <div style={{display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh'}}>\n                <CreateRoom setUserAndRoom={this.setUserAndRoom}/>\n            </div>\n        )\n        const loading = (\n            <div style={{display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh'}}>\n                <CircularProgress/>\n            </div>\n        )\n\n        const canvas = (\n            <div style={{display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh'}}>\n                {/*<P5Wrapper sketch={this.sketch} />*/}\n                <Sketch setup={this.setup} draw={this.draw} keyPressed={this.keyPressed}\n                        keyReleased={this.keyReleased}/>\n\n            </div>\n        )\n        // return canvas;\n        return (this.state.showForm ? form : (this.state.isConnected) ? canvas : loading)\n\n    }\n\n}\n\nexport default PongWithFriends;"]},"metadata":{},"sourceType":"module"}