{"ast":null,"code":"import _regeneratorRuntime from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/inherits\";import _taggedTemplateLiteral from\"/app/src/main/fun-with-friends/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  color: #888;\\n  margin-top: 2rem;\\n  margin-bottom: 2rem;\\n  .value {\\n    flex: 1;\\n    font-size: 2rem;\\n  }\\n  .slider {\\n    flex: 1;\\n    -webkit-appearance: none;\\n    width: 100%;\\n    height: 15px;\\n    border-radius: 5px;\\n    background: #efefef;\\n    outline: none;\\n    &::-webkit-slider-thumb {\\n      -webkit-appearance: none;\\n      appearance: none;\\n      \",\"\\n    }\\n    &::-moz-range-thumb {\\n      \",\"\\n    }\\n  }\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{Component}from\"react\";import Sketch from\"react-p5\";import p5 from'p5';import SockJS from'sockjs-client';import Stomp from'stompjs';import CircularProgress from'@material-ui/core/CircularProgress';import SubmitUser from\"../components/SubmitUser\";import CreateRoom from\"../components/CreateRoom\";import styled from'styled-components';var sliderThumbStyles=function sliderThumbStyles(props){return\"\\n  width: 25px;\\n  height: 25px;\\n  background: \".concat(props.color,\";\\n  cursor: pointer;\\n  outline: 5px solid #333;\\n  -webkit-transition: .2s;\\n  transition: opacity .2s;\\n\");};var Styles=styled.div(_templateObject(),function(props){return sliderThumbStyles(props);},function(props){return sliderThumbStyles(props);});var DrawWithFriends=/*#__PURE__*/function(_Component){_inherits(DrawWithFriends,_Component);function DrawWithFriends(){var _getPrototypeOf2;var _this;_classCallCheck(this,DrawWithFriends);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(DrawWithFriends)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={sender:'',room:'',showForm:true,isConnected:false,colorValue:50,brushRadius:10};_this.setupBeforeUnloadListener=function(){window.addEventListener(\"beforeunload\",function(ev){ev.preventDefault();var confirmationMessage='you are now leaving';_this.disconnect(ev);ev.returnValue=confirmationMessage;return confirmationMessage;});};_this.ws=null;_this.stompClient=null;_this.topic=null;_this.currentSubscription=null;_this.p=new p5();_this.joinRoom=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var joinRoomResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"/game-room/join-\".concat(_this.state.room),{method:\"post\",headers:{Authorization:\"Bearer \"+localStorage.getItem(\"user\"),\"Content-Type\":\"application/json\"}});case 3:joinRoomResponse=_context.sent;_this.ws=new SockJS(\"/play\");_this.stompClient=Stomp.over(_this.ws);_this.stompClient.connect({},_this.onConnected);_context.next=13;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.log('Error joining room!');console.log(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));_this.leaveRoom=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var leaveRoomResponse;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"/game-room/leave\",{method:\"post\",headers:{Authorization:\"Bearer \"+localStorage.getItem(\"user\"),\"Content-Type\":\"application/json\"}});case 3:leaveRoomResponse=_context2.sent;_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);console.log('Error leaving room!');console.log(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));_this.enterRoom=function(){var username=_this.state.name;_this.topic=\"/app/game/\".concat(_this.state.room);if(_this.currentSubscription){_this.currentSubscription.unsubscribe();}_this.currentSubscription=_this.stompClient.subscribe(\"/topic/\".concat(_this.state.room),_this.onMessageReceived);_this.stompClient.send(\"\".concat(_this.topic,\"/addUser\"),{},JSON.stringify({sender:username,type:'JOIN'}));_this.setState({isConnected:true});};_this.onConnected=function(){_this.enterRoom();};_this.disconnect=function(event){if(_this.stompClient!==null){_this.leaveRoom();console.log(\"left room\");// Tell your username to the server\n_this.currentSubscription=_this.stompClient.subscribe(\"/topic/\".concat(_this.state.room),_this.onMessageReceived);_this.stompClient.send(\"\".concat(_this.topic,\"/addUser\"),{},JSON.stringify({sender:_this.state.name,type:'LEAVE'}));_this.setState({isConnected:false});_this.stompClient.disconnect({},_this.onDisconnected);}event.preventDefault();};_this.onDisconnected=function(){_this.leaveRoom();console.log(\"left room\");// Tell your username to the server\n_this.currentSubscription=_this.stompClient.subscribe(\"/topic/\".concat(_this.state.room),_this.onMessageReceived);_this.stompClient.send(\"\".concat(_this.topic,\"/addUser\"),{},JSON.stringify({sender:_this.state.name,type:'LEAVE'}));_this.setState({isConnected:false});};_this.onMessageReceived=function(message){var messageDat=JSON.parse(message.body);console.log(\"the sender: \"+messageDat.sender);if(messageDat.sender!==_this.state.sender&&messageDat.type==='CHAT'){_this.newDrawing(messageDat);}console.log(\"received: \"+messageDat);};_this.setUserAndRoom=function(usr){// this.login(usr);\nconsole.log(\"the set data:\"+usr.user);_this.setState({sender:usr.user,room:usr.room,showForm:false},function(){var username=_this.state.sender;_this.joinRoom();// if (username) {\n// }\n});};_this.canvasWidth=800;_this.canvasHeight=800;_this.setup=function(p5,parent){_this.p.createCanvas(_this.canvasWidth,_this.canvasHeight).parent(parent);_this.p.background(51);// const slider = this.p.createSlider(0, 255, 100);\n// const color_picker = this.p.createColorPicker(\"green\").parent(parent);\n};_this.HUEtoRGB=function(H){var R=Math.abs(H*6.0-3.0)-1.0;var G=2.0-Math.abs(H*6.0-2.0);var B=2.0-Math.abs(H*6.0-4.0);return[Math.max(0,Math.min(255,R*255)),Math.max(0,Math.min(255,G*255)),Math.max(0,Math.min(255,B*255))];};_this.newDrawing=function(messageContent){var data=JSON.parse(messageContent.content);console.log(\"the sender is: \"+_this.state.sender);console.log(\"the data:\"+data.mouseX);console.log(\"the data:\"+data.mouseY);console.log(\"the data r,g,b: \"+data.r+\" \"+data.g+\" \"+data.b);_this.p.noStroke();_this.p.fill(data.r,data.g,data.b);_this.p.ellipse(data.mouseX,data.mouseY,data.brushRadius,data.brushRadius);};_this.mouseDragged=function(p5){console.log('sending: '+_this.p.mouseX+','+_this.p.mouseY);var fillCol=_this.HUEtoRGB(_this.state.colorValue/1000);var r=fillCol[0];var g=fillCol[1];var b=fillCol[2];var data={sender:_this.state.sender,content:JSON.stringify({r:parseInt(r),g:parseInt(g),b:parseInt(b),mouseX:parseInt(_this.p.mouseX),mouseY:parseInt(_this.p.mouseY),brushRadius:parseInt(_this.state.brushRadius)}),type:'CHAT'};if(_this.p.mouseX>=0&&_this.p.mouseY>=0){console.log(\"the mouse position X: \"+_this.p.mouseX+\" is less than \"+_this.canvasWidth);console.log(\"the mouse position Y: \"+_this.p.mouseY+\" is less than \"+_this.canvasHeight);if(_this.p.mouseX<_this.canvasWidth&&_this.p.mouseY<_this.canvasHeight)_this.stompClient.send(\"\".concat(_this.topic,\"/sendMessage\"),{},JSON.stringify(data));}_this.p.noStroke();_this.p.fill(r,g,b);_this.p.ellipse(parseInt(_this.p.mouseX),parseInt(_this.p.mouseY),parseInt(_this.state.brushRadius),parseInt(_this.state.brushRadius));};_this.handleColorChange=function(e){_this.setState({colorValue:e.target.value});};_this.handleRadiusChange=function(e){_this.setState({brushRadius:e.target.value});};return _this;}_createClass(DrawWithFriends,[{key:\"componentDidMount\",value:function componentDidMount(){this.setupBeforeUnloadListener();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.setupBeforeUnloadListener();}},{key:\"render\",value:function render(){var form=React.createElement(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'}},React.createElement(CreateRoom,{setUserAndRoom:this.setUserAndRoom}));var loading=React.createElement(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'}},React.createElement(CircularProgress,null));var canvas=React.createElement(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',height:'100vh'}},React.createElement(Styles,{color:\"rgb(\".concat(this.HUEtoRGB(this.state.colorValue/1000)[0],\",\").concat(this.HUEtoRGB(this.state.colorValue/1000)[1],\",\").concat(this.HUEtoRGB(this.state.colorValue/1000)[2],\")\")},React.createElement(\"input\",{type:\"range\",min:0,max:1000,className:\"slider\",onChange:this.handleColorChange}),React.createElement(\"div\",{className:\"value\"},\"color\")),React.createElement(Styles,{color:'#EFEFEF'},React.createElement(\"input\",{type:\"range\",min:1,max:50,className:\"slider\",onChange:this.handleRadiusChange}),React.createElement(\"div\",{className:\"value\"},this.state.brushRadius)),React.createElement(Sketch,{setup:this.setup,draw:this.draw,mouseDragged:this.mouseDragged}));return this.state.showForm?form:this.state.isConnected?canvas:loading;// return canvas;\n}}]);return DrawWithFriends;}(Component);export default DrawWithFriends;","map":{"version":3,"sources":["/app/src/main/fun-with-friends/src/sketches/DrawWithFriends.js"],"names":["React","Component","Sketch","p5","SockJS","Stomp","CircularProgress","SubmitUser","CreateRoom","styled","sliderThumbStyles","props","color","Styles","div","DrawWithFriends","state","sender","room","showForm","isConnected","colorValue","brushRadius","setupBeforeUnloadListener","window","addEventListener","ev","preventDefault","confirmationMessage","disconnect","returnValue","ws","stompClient","topic","currentSubscription","p","joinRoom","fetch","method","headers","Authorization","localStorage","getItem","joinRoomResponse","over","connect","onConnected","console","log","leaveRoom","leaveRoomResponse","enterRoom","username","name","unsubscribe","subscribe","onMessageReceived","send","JSON","stringify","type","setState","event","onDisconnected","message","messageDat","parse","body","newDrawing","setUserAndRoom","usr","user","canvasWidth","canvasHeight","setup","parent","createCanvas","background","HUEtoRGB","H","R","Math","abs","G","B","max","min","messageContent","data","content","mouseX","mouseY","r","g","b","noStroke","fill","ellipse","mouseDragged","fillCol","parseInt","handleColorChange","e","target","value","handleRadiusChange","form","display","justifyContent","alignItems","height","loading","canvas","draw"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\nimport Sketch from \"react-p5\";\nimport p5 from 'p5';\nimport SockJS from 'sockjs-client';\nimport Stomp from 'stompjs';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport SubmitUser from \"../components/SubmitUser\";\nimport CreateRoom from \"../components/CreateRoom\";\nimport styled from 'styled-components';\n\nconst sliderThumbStyles = (props) => (`\n  width: 25px;\n  height: 25px;\n  background: ${props.color};\n  cursor: pointer;\n  outline: 5px solid #333;\n  -webkit-transition: .2s;\n  transition: opacity .2s;\n`);\n\n\n\nconst Styles = styled.div`\n  display: flex;\n  align-items: center;\n  color: #888;\n  margin-top: 2rem;\n  margin-bottom: 2rem;\n  .value {\n    flex: 1;\n    font-size: 2rem;\n  }\n  .slider {\n    flex: 1;\n    -webkit-appearance: none;\n    width: 100%;\n    height: 15px;\n    border-radius: 5px;\n    background: #efefef;\n    outline: none;\n    &::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      appearance: none;\n      ${props => sliderThumbStyles(props)}\n    }\n    &::-moz-range-thumb {\n      ${props => sliderThumbStyles(props)}\n    }\n  }\n`;\n\nclass DrawWithFriends extends Component {\n    state = {\n        sender: '',\n        room: '',\n        showForm: true,\n        isConnected: false,\n        colorValue: 50,\n        brushRadius: 10\n    };\n    setupBeforeUnloadListener = () => {\n        window.addEventListener(\"beforeunload\", (ev) => {\n            ev.preventDefault();\n            const confirmationMessage = 'you are now leaving'\n            this.disconnect(ev);\n            ev.returnValue = confirmationMessage\n            return confirmationMessage;\n        });\n    };\n\n    componentDidMount() {\n        this.setupBeforeUnloadListener();\n    }\n\n    componentWillUnmount() {\n      this.setupBeforeUnloadListener();\n    }\n\n\n    ws = null;\n    stompClient = null;\n    topic = null;\n    currentSubscription = null;\n    p = new p5();\n\n    joinRoom = async () => {\n        try {\n            const joinRoomResponse = await fetch(`/game-room/join-${this.state.room}`,\n                {\n                    method: \"post\",\n                    headers: {\n                        Authorization: \"Bearer \" + localStorage.getItem(\"user\"),\n                        \"Content-Type\": \"application/json\"\n                    }\n                })\n            this.ws = new SockJS(\"/play\");\n            this.stompClient = Stomp.over(this.ws);\n            this.stompClient.connect({}, this.onConnected)\n        } catch (error) {\n            console.log('Error joining room!')\n            console.log(error)\n        }\n    }\n\n    leaveRoom = async () => {\n        try {\n            const leaveRoomResponse = await fetch(`/game-room/leave`,\n                {\n                    method: \"post\",\n                    headers: {\n                        Authorization: \"Bearer \" + localStorage.getItem(\"user\"),\n                        \"Content-Type\": \"application/json\"\n                    }\n                })\n        }catch (e) {\n            console.log('Error leaving room!');\n            console.log(e);\n        }\n    }\n\n    enterRoom = () => {\n        const username = this.state.name;\n        this.topic = `/app/game/${this.state.room}`;\n        if (this.currentSubscription) {\n            this.currentSubscription.unsubscribe();\n        }\n        this.currentSubscription = this.stompClient.subscribe(`/topic/${this.state.room}`, this.onMessageReceived);\n\n        this.stompClient.send(`${this.topic}/addUser`, {}, JSON.stringify({sender: username, type: 'JOIN'}));\n        this.setState({isConnected: true})\n\n    }\n\n    onConnected = () => {\n        this.enterRoom();\n    }\n\n    disconnect = (event) => {\n        if (this.stompClient !== null) {\n            this.leaveRoom();\n            console.log(\"left room\");\n            // Tell your username to the server\n            this.currentSubscription = this.stompClient.subscribe(`/topic/${this.state.room}`, this.onMessageReceived);\n\n            this.stompClient.send(`${this.topic}/addUser`, {}, JSON.stringify({sender: this.state.name, type: 'LEAVE'}));\n            this.setState({isConnected: false})\n            this.stompClient.disconnect({}, this.onDisconnected);\n        }\n        event.preventDefault();\n\n    }\n\n    onDisconnected = () => {\n        this.leaveRoom();\n        console.log(\"left room\");\n        // Tell your username to the server\n        this.currentSubscription = this.stompClient.subscribe(`/topic/${this.state.room}`, this.onMessageReceived);\n\n        this.stompClient.send(`${this.topic}/addUser`, {}, JSON.stringify({sender: this.state.name, type: 'LEAVE'}));\n        this.setState({isConnected: false})\n    }\n\n    onMessageReceived = (message) => {\n        const messageDat = JSON.parse(message.body);\n        console.log(\"the sender: \" + messageDat.sender)\n        if ((messageDat.sender !== this.state.sender) && messageDat.type === 'CHAT') {\n            this.newDrawing(messageDat);\n        }\n        console.log(\"received: \" + messageDat)\n    }\n\n    setUserAndRoom = (usr) => {\n        // this.login(usr);\n        console.log(\"the set data:\" + usr.user);\n        this.setState({\n            sender: usr.user,\n            room: usr.room,\n            showForm: false\n        }, () => {\n            const username = this.state.sender;\n            this.joinRoom();\n            // if (username) {\n\n            // }\n        })\n    }\n\n    canvasWidth = 800;\n    canvasHeight = 800;\n    setup = (p5, parent) => {\n        this.p.createCanvas(this.canvasWidth, this.canvasHeight).parent(parent);\n        this.p.background(51);\n        // const slider = this.p.createSlider(0, 255, 100);\n\n        // const color_picker = this.p.createColorPicker(\"green\").parent(parent);\n\n    }\n    HUEtoRGB = (H) => {\n        let R = Math.abs(H * 6.0 - 3.0) - 1.0;\n        let G = 2.0 - Math.abs(H * 6.0 - 2.0);\n        let B = 2.0 - Math.abs(H * 6.0 - 4.0);\n        return [Math.max(0, Math.min(255, R*255)),\n            Math.max(0, Math.min(255, G*255)),\n            Math.max(0, Math.min(255, B*255))];\n    }\n\n\n    newDrawing = (messageContent) => {\n        const data = JSON.parse(messageContent.content)\n        console.log(\"the sender is: \" + this.state.sender);\n        console.log(\"the data:\" + data.mouseX)\n        console.log(\"the data:\" + data.mouseY)\n        console.log(\"the data r,g,b: \" + data.r + \" \" + data.g + \" \" + data.b)\n        this.p.noStroke();\n        this.p.fill(data.r, data.g, data.b)\n        this.p.ellipse(data.mouseX, data.mouseY, data.brushRadius, data.brushRadius);\n    }\n\n    mouseDragged = (p5) => {\n        console.log('sending: ' + this.p.mouseX + ',' + this.p.mouseY);\n        const fillCol = this.HUEtoRGB(this.state.colorValue/1000);\n        const r = fillCol[0];\n        const g = fillCol[1];\n        const b = fillCol[2];\n        const data = {\n            sender: this.state.sender,\n            content: JSON.stringify({\n                r: parseInt(r),\n                g: parseInt(g),\n                b: parseInt(b),\n                mouseX: parseInt(this.p.mouseX),\n                mouseY: parseInt(this.p.mouseY),\n                brushRadius: parseInt(this.state.brushRadius)\n            }),\n            type: 'CHAT'\n        }\n        if(this.p.mouseX >= 0 && this.p.mouseY >= 0){\n            console.log(\"the mouse position X: \"+ this.p.mouseX +\" is less than \" +this.canvasWidth);\n            console.log(\"the mouse position Y: \"+ this.p.mouseY +\" is less than \" +this.canvasHeight);\n            if(this.p.mouseX<this.canvasWidth && this.p.mouseY < this.canvasHeight)\n                this.stompClient.send(`${this.topic}/sendMessage`, {}, JSON.stringify(data))\n        }\n        this.p.noStroke();\n        this.p.fill(r, g, b);\n        this.p.ellipse(parseInt(this.p.mouseX), parseInt(this.p.mouseY), parseInt(this.state.brushRadius), parseInt(this.state.brushRadius));\n\n    }\n\n    handleColorChange = (e) => {\n        this.setState({colorValue: e.target.value})\n    }\n\n    handleRadiusChange = (e) => {\n        this.setState( {brushRadius: e.target.value})\n    }\n\n\n\n    render() {\n        const form = (\n            <div style={{display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh'}}>\n                <CreateRoom setUserAndRoom={this.setUserAndRoom}/>\n            </div>\n        )\n        const loading = (\n            <div style={{display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh'}}>\n                <CircularProgress/>\n            </div>\n        )\n        const canvas = (\n            <div style={{display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh'}}>\n                <Styles color ={`rgb(${this.HUEtoRGB(this.state.colorValue/1000)[0]},${this.HUEtoRGB(this.state.colorValue/1000)[1]},${this.HUEtoRGB(this.state.colorValue/1000)[2]})`}>\n                    <input type='range' min={0} max={1000} className='slider' onChange={this.handleColorChange}/>\n                    <div className=\"value\">color</div>\n                </Styles>\n                <Styles color={'#EFEFEF'}>\n                    <input type='range' min={1} max={50} className='slider' onChange={this.handleRadiusChange}/>\n                    <div className=\"value\">{this.state.brushRadius}</div>\n                </Styles>\n                <Sketch setup={this.setup} draw={this.draw} mouseDragged={this.mouseDragged} />\n            </div>\n        )\n        return (this.state.showForm ? form : (this.state.isConnected) ? canvas : loading)\n            // return canvas;\n    }\n}\n\nexport default DrawWithFriends;"]},"metadata":{},"sourceType":"module"}